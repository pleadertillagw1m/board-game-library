<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Night Picker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-light: #6b7280;
            
            /* Modern Pastel Badge Colors */
            --badge-green-bg: #dcfce7; --badge-green-text: #166534;
            --badge-yellow-bg: #fef9c3; --badge-yellow-text: #854d0e;
            --badge-red-bg: #fee2e2; --badge-red-text: #991b1b;
            --badge-blue-bg: #dbeafe; --badge-blue-text: #1e40af;
            --badge-purple-bg: #f3e8ff; --badge-purple-text: #6b21a8;
            --badge-gray-bg: #f3f4f6; --badge-gray-text: #374151;
        }

        /* Global Reset for better sizing */
        * { box-sizing: border-box; }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-color); 
            padding: 20px; 
            color: var(--text-main);
            line-height: 1.5;
        }

        h1 { 
            text-align: center; 
            margin-bottom: 40px; 
            font-weight: 800; 
            color: #111827; 
            font-size: 2.5rem;
            letter-spacing: -0.025em;
        }

        /* Controls Area */
        .controls { 
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            margin-bottom: 50px; 
            flex-wrap: wrap; 
        }
        
        input, select { 
            padding: 12px 16px; 
            border: 1px solid #e5e7eb; 
            border-radius: 12px; 
            width: 260px; 
            font-size: 0.95rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05); 
            font-family: 'Inter', sans-serif;
        }

        /* Grid Layout */
        #game-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 30px; 
            max-width: 1400px; 
            margin: 0 auto; 
        }

        /* --- 3D FLIP CARD CSS --- */
        
        .card {
            background-color: transparent;
            height: 540px; 
            perspective: 1000px; 
            cursor: pointer;
            position: relative; 
            transition: z-index 0s linear 0.3s;
        }

        .card.is-flipped {
            z-index: 100; 
            transition: z-index 0s; 
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: left;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border-radius: 20px;
        }

        .card:hover .card-inner {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
        }

        .card.is-flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 20px;
            background-color: var(--card-bg);
            border: 1px solid #f3f4f6;
            overflow: hidden;
        }

        .card-back {
            transform: rotateY(180deg);
            padding: 30px;
            display: flex;
            flex-direction: column;
            overflow-y: auto; 
        }
        
        .description-text {
            color: var(--text-main);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .flip-hint {
            margin-top: auto;
            text-align: center;
            color: var(--text-light);
            font-size: 0.8rem;
            padding-top: 15px;
            font-style: italic;
        }

        /* --- FRONT FACE STYLES --- */
        
        .card-image-container { 
            height: 275px; 
            background-color: #ffffff; 
            position: relative; 
            overflow: hidden; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border-bottom: 1px solid #f3f4f6;
            padding: 15px;
        }
        
        .card-img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
        
        .rating-badge { 
            position: absolute; top: 12px; right: 12px; 
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); 
            color: white; padding: 6px 12px; border-radius: 99px; 
            font-size: 0.85rem; font-weight: 800; 
            box-shadow: 0 4px 6px rgba(217, 119, 6, 0.3); z-index: 2;
            display: flex; align-items: center; gap: 5px;
        }

        .tap-badge {
            position: absolute; top: 12px; left: 12px;
            background: rgba(0,0,0,0.05); color: #6b7280;
            padding: 4px 8px; border-radius: 8px;
            font-size: 0.7rem; font-weight: 600;
            pointer-events: none;
        }

        .card-content { 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            justify-content: flex-start; 
            gap: 10px; 
            height: calc(100% - 275px); 
        }
        
        /* TITLE MAGIC UPDATED: CENTER ALIGNMENT */
        .card-title { 
            font-size: 1.35rem; 
            font-weight: 700; 
            color: #111827; 
            line-height: 1.15; 
            margin-bottom: 0;
            display: flex;
            
            /* CHANGED: Centers vertically and horizontally */
            align-items: center; 
            justify-content: center;
            text-align: center;
            
            min-height: 3.2rem; 
        }

        .card-title span {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .quick-strip { display: flex; justify-content: space-between; background: #f9fafb; padding: 10px; border-radius: 12px; border: 1px solid #e5e7eb; }
        .quick-item { text-align: center; flex: 1; border-right: 1px solid #e5e7eb; }
        .quick-item:last-child { border-right: none; }
        .quick-label { display: block; font-size: 0.65rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; font-weight: 600; }
        .quick-value { font-weight: 700; color: var(--text-main); font-size: 0.9rem; }
        .quick-icon { color: #9ca3af; margin-right: 4px; }

        .fit-strip { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 8px; 
            margin-top: auto; 
        }
        
        .fit-badge { font-size: 0.75rem; padding: 8px 4px; border-radius: 8px; text-align: center; font-weight: 600; background: var(--badge-gray-bg); color: var(--badge-gray-text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .bg-green { background: var(--badge-green-bg); color: var(--badge-green-text); }
        .bg-yellow { background: var(--badge-yellow-bg); color: var(--badge-yellow-text); }
        .bg-red { background: var(--badge-red-bg); color: var(--badge-red-text); }
        .bg-blue { background: var(--badge-blue-bg); color: var(--badge-blue-text); }
        .bg-purple { background: var(--badge-purple-bg); color: var(--badge-purple-text); }
        
        .separator { border: 0; border-top: 1px solid #f3f4f6; margin: 0; }
    </style>
</head>
<body>

    <h1>ðŸŽ² Game Library</h1>

    <div class="controls">
        <input type="text" id="searchInput" placeholder="ðŸ” Search title, description...">
        <select id="playerFilter">
            <option value="all">ðŸ‘¥ Any Player Count</option>
            <option value="2">2 Players</option>
            <option value="3">3 Players</option>
            <option value="4">4 Players</option>
            <option value="5">5 Players</option>
            <option value="6">6+ Players</option>
        </select>
    </div>

    <div id="game-grid">Loading collection...</div>

    <script>
        // --- CONFIGURATION ---
        let sheetLink = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSVgdsccoaBe_HHr869Hv_U3V8UJ22nsMQC3cn-Ovi7z_AZRNrEJH2Jnn2ppE0hHdk0x5nCENKyd_Fv/pubhtml?gid=0&single=true";

        if (sheetLink.includes('/pubhtml')) { sheetLink = sheetLink.replace('/pubhtml', '/pub').replace('?', '?output=csv&'); }
        sheetLink += "&t=" + Date.now(); 

        let games = [];
        const grid = document.getElementById('game-grid');
        const searchInput = document.getElementById('searchInput');
        const playerFilter = document.getElementById('playerFilter');

        function init() {
            Papa.parse(sheetLink, {
                download: true, header: true, skipEmptyLines: true,
                complete: function(results) { games = results.data; displayGames(games); }
            });
        }

        function toggleFlip(card) {
            card.classList.toggle('is-flipped');
        }

        function getColorClass(text) {
            if (!text) return '';
            const t = text.toLowerCase();
            
            if (t.includes('team')) return 'bg-purple';
            if (t.includes('co-op')) return 'bg-blue';
            if (t.includes('competitive')) return 'bg-red';
            if (t.includes('solo')) return 'bg-blue';

            if (t.includes('easy') || t.includes('light') || t.includes('low') || t.includes('fast') || t.includes('quick')) return 'bg-green';
            if (t.includes('medium') || t.includes('moderate')) return 'bg-yellow';
            if (t.includes('hard') || t.includes('heavy') || t.includes('high') || t.includes('long') || t.includes('slow')) return 'bg-red';
            
            return '';
        }

        function displayGames(gamesToShow) {
            grid.innerHTML = ''; 
            gamesToShow.forEach(game => {
                if (!game.Title) return;

                const gameMode = game['Game Mode'] || '-';
                const complexity = game['Complexity Weight'] || '-';
                const setupTime = game['Setup Time'] || '-';
                const genre = game['Genre'] || '-'; 
                const rating = game['Rating'];
                
                // Get Description
                const description = game['Description'] || "No description available.";

                // Image Handling
                let imageSrc = game['Image URL'];
                let imageHTML = `<div style="color:#cbd5e1; text-align:center;"><i class="fas fa-image fa-3x"></i></div>`;
                if (imageSrc) {
                    imageSrc = imageSrc.trim(); 
                    let referrerPolicy = "";
                    if (imageSrc.includes('drive.google.com')) {
                        referrerPolicy = 'referrerpolicy="no-referrer"';
                        try { const id = imageSrc.split('/d/')[1].split('/')[0]; imageSrc = `https://drive.google.com/thumbnail?sz=w500&id=${id}`; } catch (e) {}
                    }
                    imageHTML = `<img src="${imageSrc}" class="card-img" alt="${game.Title}" ${referrerPolicy} onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display:none; color:#cbd5e1; text-align:center; width:100%; height:100%; align-items:center; justify-content:center; flex-direction:column;">
                            <i class="fas fa-image fa-2x"></i><span style="font-size:0.8rem; margin-top:5px;">No Image</span>
                        </div>`;
                }

                let ratingHTML = '';
                if (rating) {
                    ratingHTML = `<div class="rating-badge"><i class="fas fa-star"></i> ${rating}</div>`;
                }

                const cardHTML = `
                    <div class="card" onclick="toggleFlip(this)">
                        <div class="card-inner">
                            
                            <div class="card-front">
                                <div class="card-image-container">
                                    ${imageHTML}
                                    <div class="tap-badge"><i class="fas fa-undo"></i> Tap</div>
                                    ${ratingHTML}
                                </div>
                                <div class="card-content">
                                    <div class="card-title"><span>${game.Title}</span></div>
                                    
                                    <div class="quick-strip">
                                        <div class="quick-item"><span class="quick-label"><i class="fas fa-users quick-icon"></i> Play</span><span class="quick-value">${game.Players || '-'}</span></div>
                                        <div class="quick-item"><span class="quick-label"><i class="fas fa-clock quick-icon"></i> Time</span><span class="quick-value">${game.Time || '-'}</span></div>
                                        <div class="quick-item"><span class="quick-label"><i class="fas fa-child quick-icon"></i> Age</span><span class="quick-value">${game.Age || '-'}</span></div>
                                    </div>

                                    <hr class="separator">

                                    <div class="fit-strip">
                                        <div class="fit-badge bg-blue" style="font-weight:700;">${genre}</div>
                                        <div class="fit-badge ${getColorClass(gameMode)}">${gameMode}</div>
                                        <div class="fit-badge ${getColorClass(complexity)}">Complexity: ${complexity}</div>
                                        <div class="fit-badge ${getColorClass(setupTime)}">Setup: ${setupTime}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="card-back">
                                <h3 style="margin-top:0; color:#3b82f6;">${game.Title}</h3>
                                <div class="description-text">
                                    ${description}
                                </div>
                                <div class="flip-hint"><i class="fas fa-undo"></i> Tap to flip back</div>
                            </div>

                        </div>
                    </div>
                `;
                grid.innerHTML += cardHTML;
            });

            if(gamesToShow.length === 0) grid.innerHTML = '<p style="text-align:center; width:100%; grid-column:1/-1; color:#6b7280;">No games found matching your search.</p>';
        }

        function filterGames() {
            const term = searchInput.value.toLowerCase();
            const playerVal = playerFilter.value;

            const filtered = games.filter(g => {
                if(!g.Title) return false;
                const matchesSearch = Object.values(g).join(' ').toLowerCase().includes(term);
                let matchesPlayer = true;
                if(playerVal !== 'all') matchesPlayer = (g.Players || "").includes(playerVal);
                return matchesSearch && matchesPlayer;
            });
            displayGames(filtered);
        }

        searchInput.addEventListener('input', filterGames);
        playerFilter.addEventListener('change', filterGames);

        init();
    </script>
</body>
</html>
